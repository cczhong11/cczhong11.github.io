<!DOCTYPE html>
<html lang="en" class="wf-firasans-n4-active wf-active">
	<head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Enable responsiveness on mobile devices -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    
    
    <meta name="generator" content="Hugo 0.37" />
    
    <title>Scala join RDD tips &middot; </title>
    <meta content="Scala join RDD tips - " property="og:title">
    <meta content=" - This blog will tell you how to accelerate join performance on rdd" property="og:description">
    <!-- CSS -->
    <link href="https://fonts.googleapis.com/css?family=Fira+Sans:300,300i,400,400i|Roboto+Mono:300,300i,400,400i" rel="stylesheet">
    <link rel="stylesheet" href="https://cczhong11.github.io/css/print.css" media="print">
    <link rel="stylesheet" href="https://cczhong11.github.io/css/poole.css">
    <link rel="stylesheet" href="https://cczhong11.github.io/css/hyde.css">
    <!-- Font-Awesome -->
    <script defer src="https://use.fontawesome.com/releases/v5.0.10/js/all.js" integrity="sha384-slN8GvtUJGnv6ca26v8EzVaR9DC58QEwsIk9q1QXdCU8Yu8ck/tL/5szYlBbqmS+" crossorigin="anonymous"></script>
    <!-- highlight.js-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/vs.min.css">
    <!-- Customised CSS -->
    <link rel="stylesheet" href="https://cczhong11.github.io/css/custom.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://cczhong11.github.io/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="https://cczhong11.github.io/favicon.png">
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-1279783853013476",
        enable_page_level_ads: true
    });
	</script>
	</head>
    <body>
        <div class="sidebar">
	<div class="container text-center sidebar-sticky">
		<div class="sidebar-about text-center">
			<a href="https://cczhong11.github.io/"><h1 class="brand"></h1></a>
			 <img src="https://cczhong11.github.io/img/kirby.png" alt="Author Image" class="img-circle headshot center"> 
			<p class="lead">
				 I am who I am. Love Cloud and Data science 
			</p>
		</div>
		
<div>
	<ul class="sidebar-nav">
		
		
				<li>
					<a href="https://cczhong11.github.io/posts/"> <span>Posts</span></a>
				</li>
				<li>
					<a href="https://cczhong11.github.io/about/"> <span>About</span></a>
				</li>
				<li>
					<a href="https://cczhong11.github.io/resume/"> <span>Resume</span></a>
				</li>
		</li>
	</ul>
</div>

        <p>
		<section class="row text-center">
	
	
	
	&nbsp;<a href="https://github.com/cczhong11"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	&nbsp;<a href="https://linkedin.com/in/tianchen-zhong"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	&nbsp;<a href="mailto:tczhong24@gmail.com"><i class="fas fa-at fa-lg" aria-hidden="true"></i></a>
	
</section>

        </p>
		<p class="copyright">&copy; 2018 Tc Zhong.
        <a href="https://creativecommons.org/licenses/by/4.0">Some Rights Reserved</a>.<br/>Built with <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
        </p>
	</div>
	<div>
	</div>
</div>

        <div class="content container">
            <div class="post">
  <h1>Scala join RDD tips</h1>
  
  <div class="col-sm-12 col-md-12">
    <span class="text-left post-date meta">
            
       <i class="fa fa-calendar" aria-hidden="true"></i> Apr 4, 2018 
      
      
        
        
            in
            
            
                <a class="meta" href="https://cczhong11.github.io/categories/cloud-computing">CLOUD COMPUTING</a>
                ,
            
                <a class="meta" href="https://cczhong11.github.io/categories/scala">SCALA</a>
                ,
            
                <a class="meta" href="https://cczhong11.github.io/categories/soark">SOARK</a>
                
            
        
      
      
      
      </span>  
  </div>    
  
  

<h1 id="why-spark-rdd-join-is-expensive">Why Spark RDD join is expensive</h1>

<p>As we know, Join is the most expensive operation on rdd. The reason is when we join two rdd, it requires corresponding keys from each RDD are located at the same partition so that they can be combined locally. Therefore, we will shuffle keys from each rdd to make sure they are in the same partition.</p>

<p><img src="https://www.safaribooksonline.com/library/view/high-performance-spark/9781491943199/assets/hpsp_0401.png" alt="" /></p>

<p>You could learn more about rdd join from <a href="https://www.safaribooksonline.com/library/view/high-performance-spark/9781491943199/ch04.html">here</a></p>

<h1 id="what-we-should-do">What we should do</h1>

<p>If these two rdds have the same key, we could partition their key in the first place with the same partitioner and then we could reduce shuffle part in <code>join</code>, which will save us lots of time.</p>

<p>We could use the following code in scala to do this thing.</p>

<pre><code class="language-scala">import org.apache.spark.HashPartitioner

val partitioner = new HashPartitioner(N)

val rddA = xxx.partitionBy(partitioner)
val rddB = xxx.partitionBy(partitioner)
rddA.join(rddB)

</code></pre>

<h1 id="how-many-partitions-we-should-choose">How many partitions we should choose?</h1>

<p>My suggestion is to choose a number that will give each executor 2~3 tasks. For example, if you have 20 executors in total, you could choose 40 as the number of partition.</p>

</div>
            <div class="footer">
                <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>

<script type="text/javascript">
    hljs.initHighlightingOnLoad();
</script>



            </div>
        </div>
        
                
    </body>
</html>
