<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  
  <meta name="author"
        content=""/>

  
  <meta name="description" content="This blog will tell you how to accelerate join performance on rdd"/>
  

  

  
  <link rel="canonical" href="http://www.tczhong.com/posts/cc/scala-spark-join/"/>

  

  <title>Scala join RDD tips &middot; TC blog</title>

  <link rel="shortcut icon" href="http://www.tczhong.com/images/favicon.ico"/>
  <link rel="stylesheet" href="http://www.tczhong.com/css/animate.min.css"/>
  <link rel="stylesheet" href="http://www.tczhong.com/css/remixicon.css"/>
  <link rel="stylesheet" href="http://www.tczhong.com/css/zozo.css"/>
  <link rel="stylesheet" href="http://www.tczhong.com/css/highlight.css"/>

  
  
</head>

<body>
<div class="main animated">
  <div class="nav_container animated fadeInDown">
  <div class="site_nav" id="site_nav">
    <ul>
      
      <li>
        <a href="http://www.tczhong.com/posts/">Posts</a>
      </li>
      
      <li>
        <a href="http://www.tczhong.com/about/hello">About</a>
      </li>
      
      <li>
        <a href="http://www.tczhong.com/tianchen_zhong.pdf">My Resume</a>
      </li>
      
      <li>
        <a href="http://www.tczhong.com/posts/project/index.html">Project</a>
      </li>
      
    </ul>
  </div>
  <div class="menu_icon">
    <a id="menu_icon"><i class="remixicon-links-line"></i></a>
  </div>
</div>

  <div class="header animated fadeInDown">
  <div class="site_title_container">
    <div class="site_title">
      <h1>
        <a href="http://www.tczhong.com/">
          <span>TC blog</span>
          <img src="http://www.tczhong.com/images/logo.svg"/>
        </a>
      </h1>
    </div>
    <div class="description">
      <p class="sub_title"></p>
      <div class="my_socials">
        
        <a href="http://www.tczhong.com/index.xml" type="application/rss+xml" title="rss" target="_blank"><i class="remixicon-rss-fill"></i></a>
      </div>
    </div>
  </div>
</div>

  <div class="content">
    <div class="post_page">
      <div class="post animated fadeInDown">
        <div class="post_title post_detail_title">
          <h2><a href='http://www.tczhong.com/posts/cc/scala-spark-join/'>Scala join RDD tips</a></h2>
          <span class="date">2018.04.21</span>
        </div>
        <div class="post_content markdown"><h1 id="why-spark-rdd-join-is-expensive">Why Spark RDD join is expensive</h1>
<p>As we know, Join is the most expensive operation on rdd. The reason is when we join two rdd, it requires corresponding keys from each RDD are located at the same partition so that they can be combined locally. Therefore, we will shuffle keys from each rdd to make sure they are in the same partition.</p>
<p><img src="https://www.safaribooksonline.com/library/view/high-performance-spark/9781491943199/assets/hpsp_0401.png" alt=""></p>
<p>You could learn more about rdd join from <a href="https://www.safaribooksonline.com/library/view/high-performance-spark/9781491943199/ch04.html">here</a></p>
<h1 id="what-we-should-do">What we should do</h1>
<p>If these two rdds have the same key, we could partition their key in the first place with the same partitioner and then we could reduce shuffle part in <code>join</code>, which will save us lots of time.</p>
<p>We could use the following code in scala to do this thing.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">import</span> org.apache.spark.HashPartitioner

<span style="color:#66d9ef">val</span> partitioner <span style="color:#66d9ef">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">HashPartitioner</span><span style="color:#f92672">(</span>N<span style="color:#f92672">)</span>

<span style="color:#66d9ef">val</span> rddA <span style="color:#66d9ef">=</span> xxx<span style="color:#f92672">.</span>partitionBy<span style="color:#f92672">(</span>partitioner<span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> rddB <span style="color:#66d9ef">=</span> xxx<span style="color:#f92672">.</span>partitionBy<span style="color:#f92672">(</span>partitioner<span style="color:#f92672">)</span>
rddA<span style="color:#f92672">.</span>join<span style="color:#f92672">(</span>rddB<span style="color:#f92672">)</span>

</code></pre></div><h1 id="how-many-partitions-we-should-choose">How many partitions we should choose?</h1>
<p>My suggestion is to choose a number that will give each executor 2~3 tasks. For example, if you have 20 executors in total, you could choose 40 as the number of partition.</p>
</div>
        <div class="post_footer">
          
        </div>
      </div>
      
      
    </div>
  </div>
  <a id="back_to_top" href="#" class="back_to_top"><span>â–³</span></a>
</div>
<footer class="footer">
  <div class="powered_by">
    <a href="https://zeuk.me">Designed by Zeuk,</a>
    <a href="http://www.gohugo.io/">Proudly published with Hugo</a>
  </div>

  <div class="footer_slogan">
    <span></span>
  </div>
</footer>



<script src="http://www.tczhong.com/js/jquery-3.3.1.min.js"></script>
<script src="http://www.tczhong.com/js/zozo.js"></script>
<script src="http://www.tczhong.com/js/highlight.pack.js"></script>
<link  href="http://www.tczhong.com/css/fancybox.min.css" rel="stylesheet">
<script src="http://www.tczhong.com/js/fancybox.min.js"></script>

<script>hljs.initHighlightingOnLoad()</script>





<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "tczhong" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</body>
</html>
